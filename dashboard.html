<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>لوحة المتدرب</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    .links{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    .links .btn{min-width:160px}
    .info{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:720px){.info{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="container">
  <div class="topbar">
    <div class="brand">لوحة المتدرب</div>
    <div class="actions"><a class="btn" href="index.html" onclick="clearStudentSession()">خروج</a></div>
  </div>

  <div class="card">
    <div class="h2">بيانات المتدرب</div>
    <div class="info" style="margin-top:12px">
      <div><b>الاسم:</b> <span id="stName"></span></div>
      <div><b>الرقم التدريبي:</b> <span id="stId"></span></div>
      <div><b>المقرر:</b> <span id="stCourse"></span></div>
      <div><b>الشعبة:</b> <span id="stSection"></span></div>
    </div>

    <div class="links">
      <a class="btn" href="policies.html">سياسات المقرر</a>
      <a class="btn" href="plan.html">خطة المقرر</a>
      <a class="btn" href="attendance.html">سجل الحضور</a>
      <a class="btn" href="grades.html">سجل الدرجات</a>
      <a class="btn" href="calendar.html">التقويم</a>
      <a class="btn" href="contact.html">التواصل</a>
    </div>

    <div id="msg" class="muted" style="margin-top:12px"></div>
  </div>
</div>

<script src="assets/app.js"></script>
<script>
(async function(){
  requireStudent();

  try{
    const me = await api("me", {});
    const st = me.student || getStudent() || {};

    document.getElementById("stName").textContent = st.name || "";
    document.getElementById("stId").textContent = st.training_id || "";
    document.getElementById("stCourse").textContent = st.course || "";
    document.getElementById("stSection").textContent = st.section || "";

    // مهم: حفظ نسخة محلية
    setStudentSession(getStudentToken(), st);
  }catch(e){
    document.getElementById("msg").textContent = "خطأ: " + (e.message || e);
  }
})();
</script>
</body>
</html>
